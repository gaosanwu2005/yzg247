!function(_this){function appendFile(p,id){var files=[];plus.io.resolveLocalFileSystemURL(p,function(entry){entry.getMetadata(function(metadata){if(console.log(metadata.size/1e3),metadata.size/1e3>500){var zippath="_doc/"+entry.name;plus.zip.compressImage({src:p,dst:zippath,overwrite:!0,width:"50%",height:"50%"},function(){console.log("Compress success!"),plus.io.resolveLocalFileSystemURL(zippath,function(e){e.getMetadata(function(metadata){console.log(metadata.size/1e3);var ul=e.toLocalURL();console.log(ul);var task=plus.uploader.createUpload("http://"+window.location.host+"/api/user/realimg",{method:"POST"},function(t,status){if(200==status){console.log("上传成功：");var obj,newurl=JSON.parse(t.responseText).data,img=document.getElementById(id),input=document.getElementById(id+"input");img.src=newurl,input.value=newurl}else console.log("上传失败")});task.addFile(ul,{key:id}),console.log("开始上传："),task.start()},function(){console.log(e.message)})})},function(error){console.log(JSON.stringify(error))})}else{var fe=document.getElementById(id),ul=entry.toLocalURL();fe.src=ul,files.push({name:id,path:ul})}},function(){console.log(e.message)})})}_this.ajax=function(col,data){myApp.showIndicator(),$$.getJSON(col,data,function(e){myApp.hideIndicator(),321==e.data&&mainView.router.refreshPage(),789==e.data&&mainView.router.back(),e.msg?myApp.alert(e.msg,function(){document.getElementById("popover")&&(console.log("bbbb"),myApp.closeModal(".popover"),document.getElementById("popover").style.display="none"),""!==e.url&&mainView.router.load({url:e.url,pushState:!0})}):""!==e.url&&mainView.router.load({url:e.url,pushState:!0})})},_this.hongbaoajax=function(col,data){myApp.showIndicator(),$$.getJSON(col,data,function(e){myApp.hideIndicator(),321==e.data&&mainView.router.refreshPage(),789==e.data&&mainView.router.back(),e.msg?myApp.confirm(e.msg,function(){console.log("抢红包")}):""!==e.url&&mainView.router.load({url:e.url,pushState:!0})})},_this.backajax=function(col,data,callback){myApp.showIndicator(),$$.getJSON(col,data,function(data){myApp.hideIndicator(),data.msg?myApp.alert(data.msg,function(){callback(data)}):data.url&&mainView.router.load({url:data.url,pushState:!0,reload:!0})})},_this.ajaxform=function(col,form){myApp.showIndicator();var storedData=myApp.formToJSON(form);$$.getJSON(col,storedData,function(data){myApp.hideIndicator(),"321"==data.data&&mainView.router.refreshPage(),data.msg?myApp.alert(data.msg,function(){document.getElementById("popover")&&(myApp.closeModal(".popover"),document.getElementById("popover").style.display="none"),""!==data.url&&mainView.router.load({url:data.url,pushState:!0,reload:!0})}):""!==data.url&&mainView.router.load({url:data.url,pushState:!0})})},_this.appendByCamera=function(id){plus.camera.getCamera().captureImage(function(p){appendFile(p,id)})},_this.appendByGallery=function(id){plus.gallery.pick(function(p){appendFile(p,id)})},_this.showimg=function(obj,name){var imgBase64="",fileObj=obj.files[0];MY.compress(fileObj,name,function(imgBase64){imgBase64=imgBase64,console.log("111"),document.getElementById(name).setAttribute("src",imgBase64)}),console.log(obj),console.log(fileObj),console.log("file.size = "+fileObj.size);var reader=new FileReader;reader.onloadstart=function(e){console.log("开始读取....")},reader.onprogress=function(e){console.log("正在读取中....")},reader.onabort=function(e){console.log("中断读取....")},reader.onerror=function(e){console.log("读取异常....")}},_this.directTurnIntoBase64=function(fileObj,callback){var r=new FileReader;r.onload=function(){imgBase64=r.result,console.log(imgBase64),callback(imgBase64)},r.readAsDataURL(fileObj)},_this.compress=function compress(fileObj,name,callback){if("undefined"==typeof FileReader)console.log("当前浏览器内核不支持base64图标压缩"),directTurnIntoBase64(fileObj,callback);else try{var reader=new FileReader;reader.onload=function(e){var image=jQuery("<img/>");console.log(image),image.load(function(){console.log("开始压缩"),square=700,canvas=document.createElement("canvas"),context=canvas.getContext("2d"),imageWidth=0,imageHeight=0,offsetX=0,offsetY=0,data="",canvas.width=square,canvas.height=square,context.clearRect(0,0,square,square),this.width>this.height?(imageWidth=Math.round(square*this.width/this.height),imageHeight=square,offsetX=-Math.round((imageWidth-square)/2)):(imageHeight=Math.round(square*this.height/this.width),imageWidth=square,offsetY=-Math.round((imageHeight-square)/2)),context.drawImage(this,offsetX,offsetY,imageWidth,imageHeight);var data=canvas.toDataURL("image/jpeg");console.log("压缩成功!"),callback(data)}),image.attr("src",e.target.result)},reader.readAsDataURL(fileObj)}catch(e){console.log("压缩失败!"),directTurnIntoBase64(fileObj,callback)}},_this.qrcode=function(obj){var inputDom,imgFile=$$(obj)[0].files,oFile=imgFile[0],oFReader=new FileReader,rFilter=/^(?:image\/bmp|image\/cis\-cod|image\/gif|image\/ief|image\/jpeg|image\/jpeg|image\/jpeg|image\/pipeg|image\/png|image\/svg\+xml|image\/tiff|image\/x\-cmu\-raster|image\/x\-cmx|image\/x\-icon|image\/x\-portable\-anymap|image\/x\-portable\-bitmap|image\/x\-portable\-graymap|image\/x\-portable\-pixmap|image\/x\-rgb|image\/x\-xbitmap|image\/x\-xpixmap|image\/x\-xwindowdump)$/i;0!==imgFile.length&&(rFilter.test(oFile.type)?(oFReader.onload=function(oFREvent){qrcode.decode(oFREvent.target.result),qrcode.callback=function(data){if(console.log(data),data=data.trim()){var obj={type:3,content:data},reg=/^(http|https|HTTPS|HTTP):\/\//,d="{"==data.slice(0,1);reg.test(data)?(obj.type=1,obj.content=data):d&&"object"==typeof(d=JSON.parse(data))&&(obj.type=2,obj.content=d),1==obj.type?window.location.href=obj.content:2==obj.type?obj.content.userid?window.location.href="{:U('Mobile/User/trans')}?p="+obj.content.userid:layer.open({content:"没有此用户"}):layer.open({content:obj.content})}else alert("没有内容")}},oFReader.readAsDataURL(oFile)):alert("选择正确的图片格式!"))},_this.timeArr=[],_this.countTime=function(el,htmll){if(console.log(1),_this.timeArr.length>10){console.log(2);for(var i=0;i<_this.timeArr.length;i++)clearInterval(_this.timeArr[i])}$$(el).each(function(k,v){var count=$$(v).attr("data-time"),ppid=$$(v).attr("data-ppid");if(!count)return!1;var count=parseInt(count),nowtime=(new Date).getTime();if(count-(nowtime=parseInt(nowtime/1e3))<0)return $$(el).html(htmll),!1;var timeC=count-nowtime;_this.timeArr.push(window.setInterval(function(){timeC--;var d=parseInt(timeC/86400),h=parseInt(timeC%86400/3600),m=parseInt(timeC%86400%3600/60),s=parseInt(timeC%86400%3600%60);if(d<=0&&h<=0&&m<=0&&s<=0){if($$(el).html(htmll),_this.timeArr.length>0)for(var i=0;i<_this.timeArr.length;i++)clearInterval(_this.timeArr[i])}else h=1==h.toString().length?"0"+h:h,m=1==m.toString().length?"0"+m:m,s=1==s.toString().length?"0"+s:s,$$(v).html(d+"&nbsp;天&nbsp;"+h+"&nbsp;小时&nbsp;"+m+"&nbsp;分钟&nbsp;"+s+"&nbsp;秒&nbsp;")},1e3))})},_this.timeArr1=[],_this.countTime1=function(el,type){if(_this.timeArr1.length>10){console.log(4);for(var i=0;i<_this.timeArr1.length;i++)clearInterval(_this.timeArr1[i])}$$(el).each(function(k,v){var count=$$(v).attr("data-time"),ppid=$$(v).attr("data-ppid");if(!count)return!1;var count=parseInt(count),nowtime=(new Date).getTime();if(count-(nowtime=parseInt(nowtime/1e3))<0){if(1==type)var htmll='<a style="width: 100px;float: right" class="button button-round" href="/index.php/index/Business/shamts?ppid='+ppid+'" >投诉</a>';else var htmll='<a style="width: 100px;float: right" class="button button-round" href="/index.php/index/Business2/shamts?ppid='+ppid+'" >投诉</a>';return $$(el).html(htmll),!1}var timeC=count-nowtime;_this.timeArr1.push(window.setInterval(function(){timeC--;var d=parseInt(timeC/86400),h=parseInt(timeC%86400/3600),m=parseInt(timeC%86400%3600/60),s=parseInt(timeC%86400%3600%60);if(d<=0&&h<=0&&m<=0&&s<=0){var htmll="已完成";if($$(el).html("已完成"),_this.timeArr1.length>0)for(var i=0;i<_this.timeArr1.length;i++)clearInterval(_this.timeArr1[i])}else h=1==h.toString().length?"0"+h:h,m=1==m.toString().length?"0"+m:m,s=1==s.toString().length?"0"+s:s,$$(v).html(d+"&nbsp;天&nbsp;"+h+"&nbsp;小时&nbsp;"+m+"&nbsp;分钟&nbsp;"+s+"&nbsp;秒&nbsp;")},1e3))})},_this.yzAccount=function(col,data,el){$$.getJSON(col,data,function(d){0===d.code?myApp.alert(d.msg):$$(el).html(d.msg)})},_this.upload=function(col,formid,el,img){var form=new FormData(document.getElementById(formid));$$.post(col,form,function(d){0===d.code?myApp.alert(d.msg):($$(el).attr("src",d.data.url),$$(img).val(d.data.url))},"json")},_this.upload2=function(col,formid,el){var form=new FormData(document.getElementById(formid));$$.post(col,form,function(d){console.log(d),0===d.code?myApp.alert(d.msg):$$(el).attr("src",d.data)},"json")},_this.upload3=function(col,formid,el){var form=new FormData(document.getElementById(formid));$$.post(col,form,function(d){var myMessagebar;(console.log(d),0===d.code)?myApp.alert(d.msg):myApp.messagebar(".messagebar").value('<img src="'+d.data.url+'" alt="img">')},"json")},_this.formpost=function(col,formid){var form=new FormData(document.getElementById(formid));$$.post(col,form,function(e){e.msg?myApp.alert(e.msg,function(){""!==e.url&&mainView.router.load({url:e.url,pushState:!0}),321==e.data&&mainView.router.refreshPage(),789==e.data&&mainView.router.back()}):""!==e.url&&mainView.router.load({url:e.url,pushState:!0})},"json")},_this.suanfee=function(col,data,max,trade,fee,btn){data.number%1!=0?(myApp.alert("数量请输入整数"),$$(btn).addClass("disabled")):($$(btn).removeClass("disabled"),$$.getJSON(col,data,function(d){0===d.code?(myApp.alert(d.msg),$$(btn).addClass("disabled")):($$(btn).removeClass("disabled"),$$(max).html(d.max),$$(trade).html(d.trade),$$(fee).val(d.fee))}))},_this.suaneth=function(usd,eth,hui){var pp=$$(usd).val()/hui;$$(eth).val(pp.toFixed(6))},_this.sum=function(p1,p2,total){var a,b,pp=(""==$$(p1).val()?0:parseFloat($$(p1).val()))+(""==$$(p2).val()?0:parseFloat($$(p2).val()));$$(total).val(pp.toFixed(2))},_this.same=function(p1,p2){$$(p2).val($$(p1).val())},_this.copywww=function(message){var input=document.createElement("input");input.value=message,document.body.appendChild(input),input.select(),input.setSelectionRange(0,input.value.length),document.execCommand("Copy"),document.body.removeChild(input),myApp.alert("复制成功")},_this.fresh1=function(){$$.getJSON("http://"+window.location.host+"/index.php/api/trade/hangqing",function(d){console.log(d);var buytpl=$("script#buytpl").html(),compile1,html=Template7.compile(buytpl)(d);$$("#buylist").html(""),$$("#buylist").append(html);var saletpl=$("script#saletpl").html(),compile2,html2=Template7.compile(saletpl)(d);$$("#salelist").html(""),$$("#salelist").append(html2);var ordertpl=$("script#ordertpl").html(),compile3,html3=Template7.compile(ordertpl)(d);$$("#orderlist").html(""),$$("#orderlist").append(html3);var historytpl=$("script#historytpl").html(),compile4,html4=Template7.compile(historytpl)(d);$$("#history").html(""),$$("#history").append(html4),MY.countTime(".countTime")})},_this.sale=function(id,num){myApp.prompt("请输入二级密码",function(value){jQuery.post("/api/user/seccodedo",{pass2:value},function(d){console.log(d),0==d.code?myApp.alert(d.msg):myApp.confirm("确定卖出"+num+"吗",function(){$$.getJSON("/index.php/api/trade/clicksale",{id:id},function(d){console.log(d),myApp.alert(d.msg),d.url&&mainView.router.load({url:d.url}),"321"==d.data&&mainView.router.refreshPage()})})},"json")},function(value){})},_this.buy=function(id,num){myApp.confirm("确定购买"+num+"吗",function(){$$.getJSON("/index.php/api/trade/clickbuy",{id:id},function(d){console.log(d),myApp.alert(d.msg),"321"==d.data&&mainView.router.refreshPage()})})},_this.cancelSaleOrder=function(id){myApp.confirm("确定撤销吗",function(){$$.getJSON("/index.php/api/trade/CancelSaleOrder",{sale:id},function(d){console.log(d),myApp.alert(d.msg),"321"==d.data&&mainView.router.refreshPage()})})},_this.cancelBuyOrder=function(id){myApp.confirm("确定撤销吗",function(){$$.getJSON("/index.php/api/trade/cancelBuyOrder",{buy:id},function(d){console.log(d),myApp.alert(d.msg),"321"==d.data&&mainView.router.refreshPage()})})},_this.setCookie=function(name,value){var Days=30,exp=new Date;exp.setTime(exp.getTime()+2592e6),document.cookie=name+"="+escape(value)+";expires="+exp.toGMTString()},_this.getCookie=function(name){var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");return(arr=document.cookie.match(reg))?unescape(arr[2]):null},_this.delCookie=function(name){var exp=new Date;exp.setTime(exp.getTime()-1);var cval=_this.getCookie(name);null!=cval&&(document.cookie=name+"="+cval+";expires="+exp.toGMTString())},_this.buyajax=function(){var lastIndex,itemsPerLoad=5,begin=$$("#buyajax li").length+11,end=5;$$.getJSON("/index.php/api/trade/buyajax/from/"+begin+"/to/5",function(d){if(console.log(d),console.log("[]"===JSON.stringify(d.buy)),"[]"===JSON.stringify(d.buy))myApp.alert("加载完毕");else{var historytpl=$("script#buytpl").html(),compile4,html=Template7.compile(historytpl)(d);$$("#buyajax").append(html)}})},_this.saleajax=function(){var lastIndex,itemsPerLoad=5,begin=$$("#saleajax li").length+11,end=5;$$.getJSON("/index.php/api/trade/saleajax/from/"+begin+"/to/5",function(d){if(console.log(d),console.log("[]"===JSON.stringify(d.sale)),"[]"===JSON.stringify(d.sale))myApp.alert("加载完毕");else{var historytpl=$("script#saletpl").html(),compile4,html=Template7.compile(historytpl)(d);$$("#saleajax").append(html)}})},_this.checklevel=function(n){n>1?mainView.router.load({url:"/index.php/api/Info/tdinfo"}):myApp.alert("您的级别不足，暂时不能创建")},_this.findcoin=function(){var bian=$$("#bian").val();$$.getJSON("index.php/api/Info/mytree/bian/"+bian,function(d){if(1==d.state){var historytpl=$("script#cointpl").html(),compile4,html=Template7.compile(historytpl)(d);$$("#treeDemo2").html(""),$$("#treeDemo2").append(html)}myApp.alert(d.msg)})},_this.chosebuy=function(obj,feth){console.log($$(obj)[0].innerText),$$.get("/index.php/index/trade2/chosebuyajax/price/"+$$(obj)[0].innerText,function(d){console.log(d),$$(feth).html(""),$$(feth).html(d)})},_this.chosesale=function(obj,feth){console.log($$(obj)[0].innerText),$$.get("/index.php/index/trade2/chosesaleajax/price/"+$$(obj)[0].innerText,function(d){console.log(d),$$(feth).html(""),$$(feth).html(d)})},_this.searchbuy=function(obj,feth){console.log($$(obj).val()),$$.get("/index.php/index/trade/buyajax/price/"+$$(obj).val(),function(d){console.log(d),$$(feth).html(""),$$(feth).html(d)})},_this.searchsale=function(obj,feth){console.log($$(obj).val()),$$.get("/index.php/index/trade/saleajax/price/"+$$(obj).val(),function(d){console.log(d),$$(feth).html(""),$$(feth).html(d)})},_this.fee=function(obj,rate,fe,rec,wall,btn){if($$(obj).val()>0){if(parseFloat($$(wall).html())<$$(obj).val())return myApp.alert("余额不足"),$$(btn).addClass("disabled"),!1;$$(btn).removeClass("disabled");var fee=$$(obj).val()*rate*.01;$$(fe).val(fee.toFixed(4));var re=$$(obj).val()-fee.toFixed(4);$$(rec).html(re.toFixed(4))}else myApp.alert("输入有误，请重新输入")},_this.all=function(obj,to,rate){$$(to).val($$(obj).html()),MY.fee("#number",rate,"#fee","#received","#wall","#up")},_this.btc2lmcfee=function(obj,rate,fe,rec,wall,btn,hl){if($$(obj).val()>0){if(parseFloat($$(wall).html())<$$(obj).val())return myApp.alert("余额不足"),$$(btn).addClass("disabled"),!1;$$(btn).removeClass("disabled");var fee=$$(obj).val()*rate*.01;$$(fe).val(fee.toFixed(4));var re=($$(obj).val()-fee.toFixed(4))*hl;$$(rec).html(re.toFixed(4))}else myApp.alert("输入有误，请重新输入")},_this.btc2lmcall=function(obj,to,rate,hl){$$(to).val($$(obj).html()),MY.btc2lmcfee("#number",rate,"#fee","#received","#wall","#up",hl)},_this.lmc2btcfee=function(obj,rate,fe,rec,wall,btn,hl){if($$(obj).val()>0){if(parseFloat($$(wall).html())<$$(obj).val())return myApp.alert("余额不足"),$$(btn).addClass("disabled"),!1;$$(btn).removeClass("disabled");var fee=$$(obj).val()*rate*.01;$$(fe).val(fee.toFixed(4));var re=($$(obj).val()-fee.toFixed(4))/hl;$$(rec).html(re.toFixed(4))}else myApp.alert("输入有误，请重新输入")},_this.lmc2btcall=function(obj,to,rate,hl){$$(to).val($$(obj).html()),MY.lmc2btcfee("#number1",rate,"#fee1","#received1","#wall1","#up1",hl)}}(window.MY={});