(function(a,d){var c=window.YDUI.dialog;a.Infinite=function(i,g,e){var h=0,f=true;if(!d(g)[0]&&!d(i)[0]){return}d(i).append('<img src="http://static.ydcss.com/uploads/ydui/loading/loading10.svg" style="width: 40px;display: block;margin: 10px auto;"/>');e=typeof e==="object"?e:{};e.success=typeof e.success==="function"?e.success:function(){};e.size=(typeof e.size*1==="number"&&!isNaN(e.size))?e.size*1:10;e.data=typeof e.data==="object"?e.data:{};e.distance=(typeof e.distance*1==="number"&&!isNaN(e.distance))?e.distance*1:100;e.type=e.type||"post";e.data.page=h;e.data.size=e.size;d(i).on("scroll",function(l){var j=d(i+" .scroll-box")[0].clientHeight,k=this.clientHeight;if(this.scrollTop<j-k-e.distance){return}if(!f){return}f=false;d.ajax({url:e.url,type:e.type,data:e.data,dataType:"html",success:function(m){e.success(m)},error:function(){c.toast("网络错误，请重新尝试","error",1000)},complete:function(){setTimeout(function(){f=true},1000)}})})};var b=true;a.ajax=function(e,f,g,h){if(!b){return}b=false;c.loading.open("正在加载···");f=typeof f==="string"?f:"post";h=typeof h==="function"?h:function(){return true};g=typeof g==="object"?g:{};d.ajax({url:e,type:f,data:g,success:function(i){if(!h(i,c)){return}if(i.info){c.toast(i.info,"error",1000,function(){if(i.url){location.href=i.url}})}else{if(i.url){location.href=i.url}}},error:function(){c.toast("网络错误，请稍后重新尝试！","none",1000)},complete:function(){c.loading.close();b=true}})};a.bindForm=function(e){var f=this;d(e).on("submit",function(){var k=d(this).attr("action");var g=d(this).attr("method")||"post";var j=d(this).serializeArray();for(var h=0;h<j.length;h++){if(!j[h].value){c.alert("所填项不能为空");return false}}f.ajax(k,g,j);return false})};a.bindUpload=function(g,f){var e=true;c.loading.open("正在上传···");switch(f){case"change":d(g).on("change",function(){if(!e){return false}e=false;var j=d(this).attr("data-url");var h=this.files[0];if(!h){c.loading.close();e=true;c.alert("上传文件不能为空");return false}var i=new FormData();i.append(this.name||"file",h);d.ajax({url:j,type:"post",data:i,processData:false,contentType:false,success:function(k){if(k.status){if(k.info){c.toast(k.info,"success",1000,function(){if(k.url){location.href=k.url}})}else{if(k.url){location.href=k.url}}}else{if(k.info){c.toast(k.info,"error",1000,function(){if(k.url){location.href=k.url}})}else{if(k.url){location.href=k.url}}}},error:function(){c.toast("网络错误，请重新尝试","none",1000)},complete:function(){c.loading.close();e=true}})});break;case"submit":d(g).on("submit",function(){if(!e){return false}e=false;var j=d(this).attr("action");var h=d(this).find("input[type=file]")[0].files[0];if(!h){c.loading.close();e=true;c.alert("上传文件不能为空");return false}var i=new FormData(this);i.append(this.name||"file",h);d.ajax({url:j,type:"post",data:i,processData:false,contentType:false,success:function(k){if(k.status){if(k.info){c.toast(k.info,"success",1000,function(){if(k.url){location.href=k.url}})}else{if(k.url){location.href=k.url}}}else{if(k.info){c.toast(k.info,"error",1000,function(){if(k.url){location.href=k.url}})}else{if(k.url){location.href=k.url}}}},error:function(){c.toast("网络错误，请重新尝试","none",1000)},complete:function(){c.loading.close();e=true}})});break}}})(window.app={},window.jQuery);